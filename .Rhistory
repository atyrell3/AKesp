?render_esp
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
devtools::load_all()
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
?read.csv
devtools::load_all()
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
devtools::load_all()
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
unique(dat$INDICATOR_NAME)
roxygen2::roxygenise()
dat <- AKesp::get_esp_data("BS Snow Crab")
head(dat)
View(dat)
esp_traffic_tab_long
NEesp::find_files()
NEesp::find_files("read.table")
NEesp::find_files("read.csv")
devtools::load_all()
# test snow crab report card
# sablefish (google example)
render_esp(esp_type = "report card",
out_dir = here::here("test"),
out_name = "snow_crab_test_rc.docx",
esp_data = AKesp::get_esp_data("BS Snow Crab"),
con_model_path = "sablefish_con_model.png",
stock_image = "sablefish.png",
bayes_path = "sablefish_bayes.png",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
google_folder_url = "https://drive.google.com/drive/folders/1d7bzQfbDb5j-jTbb366vWtHpx5t8wxWe")
read.csv('C:/Users/ABIGAI~1.TYR/AppData/Local/Temp/1/Rtmpg7dy9I/temp_esp/C:/Users/ABIGAI~1.TYR/AppData/Local/Temp/1/Rtmpg7dy9I/temp_esp/references_spreadsheet.csv')
render_esp <- function(out_name = "EXAMPLE-FULL-ESP.docx",
out_dir = getwd(),
num = 1, # Appendix number
authors = "Kalei Shotwell, Abby Tyrell",
year = 2021,
contributors = "Kalei Shotwell, Abby Tyrell",
fish = "Myfish",
region = "Myarea",
fig_spreadsheet = "figure_spreadsheet.csv",
tab_spreadsheet = "table_spreadsheet.csv",
ref_spreadsheet = "references_spreadsheet.csv",
esp_text = "full-esp-text-template.docx",
esp_type = "full",
esp_data = NULL,
con_model_path = "default",
stock_image = "default",
bayes_path = "default",
google_folder_url = NULL
) {
# if using a google folder, download files and point to temp folder
if(!is.null(google_folder_url)){
# download files
google <- use_google_files(google_folder_url,
overwrite = TRUE)
# reassign file paths to point to temp folder downloads
fig_spreadsheet <- paste(google, fig_spreadsheet, sep = "/")
tab_spreadsheet <- paste(google, tab_spreadsheet, sep = "/")
ref_spreadsheet <- paste(google, ref_spreadsheet, sep = "/")
message(ref_spreadsheet)
esp_text <- paste(google, esp_text, sep = "/")
if(stock_image != "default"){
stock_image <- paste(google, stock_image, sep = "/")
}
if(con_model_path != "default"){
con_model_path <- paste(google, con_model_path, sep = "/")
}
if(bayes_path != "default"){
bayes_path <- paste(google, bayes_path, sep = "/")
}
dir <- google
} else { dir <- out_dir }
# create references.bib
# message(getwd())
message("creating .bib file...")
AKesp::render_ref(refs = ref_spreadsheet, dir = dir)
args <- list(
num, authors, year, contributors, fish, region,
fig_spreadsheet, tab_spreadsheet, esp_text, esp_type,
esp_data, con_model_path, bayes_path, stock_image
)
names(args) <- c(
"num", "authors", "year", "contributors", "fish", "region",
"fig_spreadsheet", "tab_spreadsheet", "esp_text", "esp_type",
"esp_data", "con_model_path", "bayes_path", "stock_image"
)
message("knitting ESP...")
rmarkdown::render(system.file("esp-template.Rmd",
package = "AKesp"
),
clean = FALSE,
params = args,
output_file = out_name,
#  knit_root_dir = dir,
output_dir = out_dir,
intermediates_dir = dir
)
if(!is.null(google_folder_url)){
unlink(google)
message("Downloaded google files successfully removed!")
}
# clean = TRUE removes .bib file
# delete files manually instead
# file.remove(
#   paste0(dir, "/esp-template.knit.md"),
#   paste0(dir, "/esp-template.utf8.md"),
#   paste0(dir, "/template.docx")
# )
}
# test snow crab report card
# sablefish (google example)
render_esp(esp_type = "report card",
out_dir = here::here("test"),
out_name = "snow_crab_test_rc.docx",
esp_data = AKesp::get_esp_data("BS Snow Crab"),
con_model_path = "sablefish_con_model.png",
stock_image = "sablefish.png",
bayes_path = "sablefish_bayes.png",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
google_folder_url = "https://drive.google.com/drive/folders/1d7bzQfbDb5j-jTbb366vWtHpx5t8wxWe")
render_esp <- function(out_name = "EXAMPLE-FULL-ESP.docx",
out_dir = getwd(),
num = 1, # Appendix number
authors = "Kalei Shotwell, Abby Tyrell",
year = 2021,
contributors = "Kalei Shotwell, Abby Tyrell",
fish = "Myfish",
region = "Myarea",
fig_spreadsheet = "figure_spreadsheet.csv",
tab_spreadsheet = "table_spreadsheet.csv",
ref_spreadsheet = "references_spreadsheet.csv",
esp_text = "full-esp-text-template.docx",
esp_type = "full",
esp_data = NULL,
con_model_path = "default",
stock_image = "default",
bayes_path = "default",
google_folder_url = NULL
) {
# if using a google folder, download files and point to temp folder
if(!is.null(google_folder_url)){
# download files
google <- use_google_files(google_folder_url,
overwrite = TRUE)
# reassign file paths to point to temp folder downloads
fig_spreadsheet <- paste(google, fig_spreadsheet, sep = "/")
tab_spreadsheet <- paste(google, tab_spreadsheet, sep = "/")
ref_spreadsheet <- paste(google, ref_spreadsheet, sep = "/")
message(ref_spreadsheet)
esp_text <- paste(google, esp_text, sep = "/")
if(stock_image != "default"){
stock_image <- paste(google, stock_image, sep = "/")
}
if(con_model_path != "default"){
con_model_path <- paste(google, con_model_path, sep = "/")
}
if(bayes_path != "default"){
bayes_path <- paste(google, bayes_path, sep = "/")
}
dir <- google
} else { dir <- out_dir }
# create references.bib
# message(getwd())
message("creating .bib file...")
AKesp::render_ref(refs = ref_spreadsheet, dir = "")
args <- list(
num, authors, year, contributors, fish, region,
fig_spreadsheet, tab_spreadsheet, esp_text, esp_type,
esp_data, con_model_path, bayes_path, stock_image
)
names(args) <- c(
"num", "authors", "year", "contributors", "fish", "region",
"fig_spreadsheet", "tab_spreadsheet", "esp_text", "esp_type",
"esp_data", "con_model_path", "bayes_path", "stock_image"
)
message("knitting ESP...")
rmarkdown::render(system.file("esp-template.Rmd",
package = "AKesp"
),
clean = FALSE,
params = args,
output_file = out_name,
#  knit_root_dir = dir,
output_dir = out_dir,
intermediates_dir = dir
)
if(!is.null(google_folder_url)){
unlink(google)
message("Downloaded google files successfully removed!")
}
# clean = TRUE removes .bib file
# delete files manually instead
# file.remove(
#   paste0(dir, "/esp-template.knit.md"),
#   paste0(dir, "/esp-template.utf8.md"),
#   paste0(dir, "/template.docx")
# )
}
# test snow crab report card
# sablefish (google example)
render_esp(esp_type = "report card",
out_dir = here::here("test"),
out_name = "snow_crab_test_rc.docx",
esp_data = AKesp::get_esp_data("BS Snow Crab"),
con_model_path = "sablefish_con_model.png",
stock_image = "sablefish.png",
bayes_path = "sablefish_bayes.png",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
google_folder_url = "https://drive.google.com/drive/folders/1d7bzQfbDb5j-jTbb366vWtHpx5t8wxWe")
devtools::load_all()
# test snow crab report card
# sablefish (google example)
render_esp(esp_type = "report card",
out_dir = here::here("test"),
out_name = "snow_crab_test_rc.docx",
esp_data = AKesp::get_esp_data("BS Snow Crab"),
con_model_path = "sablefish_con_model.png",
stock_image = "sablefish.png",
bayes_path = "sablefish_bayes.png",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
google_folder_url = "https://drive.google.com/drive/folders/1d7bzQfbDb5j-jTbb366vWtHpx5t8wxWe")
# snow crab!!
dir.create(here::here("snow_crab"))
devtools::load_all()
devtools::load_all()
create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
remotes::install_github("atyrell3/AKesp")
remotes::install_github("atyrell3/AKesp")
remotes::install_github("atyrell3/AKesp")
AKesp::render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
AKesp::render_esp(out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
roxygen2::roxygenise
roxygen2::roxygenise
roxygen2::roxygenise()
?AKesp::render_esp
AKesp::render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
dat <- AKesp::get_esp_data("Alaska Sablefish")
colnames(dat)
R.version
expected_colnames <- c("YEAR", "INDICATOR_NAME", "DATA_VALUE",
"DATA_SOURCE_NAME", "DATABASE_NAME", "PRODUCT",
"PRODUCT_DESCRIPTION", "INDICATOR_TYPE", "CATEGORY",
"CONTACT", "FREQUENCY", "REGION", "TIME_START",
"TIME_END", "AKFIN", "ESR", "REFERENCE", "PRELIMINARY",
"REPORT_CARD_TITLE", "INTENDED_ESP_NAME",
"SUBMISSION_YEAR", "GATE1_YEAR", "GATE2_YEAR",
"REMOVED_YEAR", "SIGN", "WEIGHT", "STATUS_TRENDS",
"INFLUENTIAL_FACTORS")
data_colnames <- "YEAR"
expected_colnames[which(! expected_colnames %in% data_colnames)]
dat <- AKesp::get_esp_data("BS Snow Crab")
check_data <- function(data, fill = TRUE) {
expected_colnames <- c("YEAR", "INDICATOR_NAME", "DATA_VALUE",
"DATA_SOURCE_NAME", "DATABASE_NAME", "PRODUCT",
"PRODUCT_DESCRIPTION", "INDICATOR_TYPE", "CATEGORY",
"CONTACT", "FREQUENCY", "REGION", "TIME_START",
"TIME_END", "AKFIN", "ESR", "REFERENCE", "PRELIMINARY",
"REPORT_CARD_TITLE", "INTENDED_ESP_NAME",
"SUBMISSION_YEAR", "GATE1_YEAR", "GATE2_YEAR",
"REMOVED_YEAR", "SIGN", "WEIGHT", "STATUS_TRENDS",
"INFLUENTIAL_FACTORS")
data_colnames <- colnames(data)
match <- sort(expected_colnames) == sort(data_colnames)
if(match){
message("all expected columns present in data")
} else if(fill) {
missing_cols <- expected_colnames[which(! expected_colnames %in% data_colnames)]
for(i in missing_cols) {
data[,i] <- NA
message("missing columns -- filled with NAs")
}
} else {
message("missing columns -- not filling!")
}
}
check_data(dat)
check_data <- function(data, fill = TRUE) {
expected_colnames <- c("YEAR", "INDICATOR_NAME", "DATA_VALUE",
"DATA_SOURCE_NAME", "DATABASE_NAME", "PRODUCT",
"PRODUCT_DESCRIPTION", "INDICATOR_TYPE", "CATEGORY",
"CONTACT", "FREQUENCY", "REGION", "TIME_START",
"TIME_END", "AKFIN", "ESR", "REFERENCE", "PRELIMINARY",
"REPORT_CARD_TITLE", "INTENDED_ESP_NAME",
"SUBMISSION_YEAR", "GATE1_YEAR", "GATE2_YEAR",
"REMOVED_YEAR", "SIGN", "WEIGHT", "STATUS_TRENDS",
"INFLUENTIAL_FACTORS")
data_colnames <- colnames(data)
match <- length(expected_colnames) == length(data_colnames)
if(match){
message("all expected columns present in data")
} else if(fill) {
missing_cols <- expected_colnames[which(! expected_colnames %in% data_colnames)]
for(i in missing_cols) {
data[,i] <- NA
message("missing columns -- filled with NAs")
}
} else {
message("missing columns -- not filling!")
}
}
check_data(dat)
check_data <- function(data, fill = TRUE) {
expected_colnames <- c("YEAR", "INDICATOR_NAME", "DATA_VALUE",
"DATA_SOURCE_NAME", "DATABASE_NAME", "PRODUCT",
"PRODUCT_DESCRIPTION", "INDICATOR_TYPE", "CATEGORY",
"CONTACT", "FREQUENCY", "REGION", "TIME_START",
"TIME_END", "AKFIN", "ESR", "REFERENCE", "PRELIMINARY",
"REPORT_CARD_TITLE", "INTENDED_ESP_NAME",
"SUBMISSION_YEAR", "GATE1_YEAR", "GATE2_YEAR",
"REMOVED_YEAR", "SIGN", "WEIGHT", "STATUS_TRENDS",
"INFLUENTIAL_FACTORS")
data_colnames <- colnames(data)
match <- length(expected_colnames) == length(data_colnames)
if(match){
message("all expected columns present in data")
} else if(fill) {
missing_cols <- expected_colnames[which(! expected_colnames %in% data_colnames)]
for(i in missing_cols) {
data[,i] <- NA
message("missing columns -- filled with NAs")
}
} else {
message("missing columns -- not filling!")
}
return(data)
}
dat2 <- check_data(dat)
head(dat)
head(dat2)
sort(colnames(dat))
sort(colnames(dat2))
head(dat2$STATUS_TRENDS)
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab"))
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
roxygen2::roxygenise()
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
?knitr::include_graphics
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
devtools::load_all()
# dir.create(here::here("snow_crab"))
# create_template(path = here::here("snow_crab"))
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
?knitr::knit_child
render_esp(out_dir = here::here("snow_crab"),
out_name = "snow_crab_test.docx",
authors = "Erin Fedewa, Kalei Shotwell, Abby Tyrell",
year = 2022,
fish = "Snow Crab",
region = "Eastern Bering Sea",
tab_spreadsheet = 1,
esp_data = AKesp::get_esp_data("BS Snow Crab") %>% check_data())
try(read.csv(file = 1))
roxygen2::roxygenise()
