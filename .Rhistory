?element_text
esp_traffic_long <- function(data,
name,
out = "ggplot",
paginate = FALSE,
label = TRUE,
caption = "",
...) {
maxyear <- max(data$YEAR)
minyear <- maxyear - 1
dat <- prep_ind_data(data)
plt <- ggplot2::ggplot(
dat,
ggplot2::aes(
x = .data$YEAR,
y = .data$DATA_VALUE,
group = name
)
) +
ggplot2::geom_rect(
data = dat %>%
dplyr::filter(.data$recent == TRUE),
ggplot2::aes(
xmin = min(.data$YEAR) + 0.5,
xmax = max(.data$YEAR) + 0.5,
ymin = .data$quant10,
ymax = .data$quant90,
group = name
),
fill = "lightgreen"
) +
ggplot2::geom_hline(ggplot2::aes(
yintercept = .data$quant10,
group = name
),
color = "darkgreen",
linetype = "solid"
) +
ggplot2::geom_hline(ggplot2::aes(
yintercept = .data$quant90,
group = name
),
color = "darkgreen",
linetype = "solid"
) +
ggplot2::geom_hline(ggplot2::aes(
yintercept = .data$mean,
group = name
),
color = "darkgreen",
linetype = "dotted"
) +
ggplot2::geom_point() +
ggplot2::geom_line(data = dat %>%
tidyr::drop_na(.data$DATA_VALUE)) +
ggplot2::geom_label(
data = dat %>%
dplyr::filter(.data$YEAR == maxyear),
ggplot2::aes(
label = .data$label,
y = .data$mean,
fill = .data$score
),
nudge_x = 4,
show.legend = FALSE
) +
# set label colors based on score
ggplot2::scale_fill_manual(values = c("-1" = "brown1",
"1" = "cornflowerblue",
"0" = "beige")) +
ggplot2::ylab("") +
ggplot2::scale_y_continuous(labels = scales::comma) +
ggplot2::theme_bw(base_size = 16) +
ggplot2::xlim(c(min(dat$YEAR), max(dat$YEAR) + 6)) +
ggplot2::theme(strip.text = ggplot2::element_text(size = 10))
finish_fig <- function() {
if (label) {
plt <- plt %>%
AKesp::label_facets(open = "", close = "")
}
if (out == "save") {
ggplot2::ggsave(plt, filename = paste0(name, "_page", i, ".png"), ...)
} else if (out == "ggplot") {
print(plt)
cat("\n\n")
cat("##### Figure \\@ref(fig:traffic).", caption, "{-}")
cat("\n\n")
} else {
stop("Please specify output format")
}
}
if (paginate == TRUE) {
nfacet <- length(unique(dat$name))
n <- ceiling(nfacet / 5)
for (i in 1:n) {
plt <- plt +
ggforce::facet_wrap_paginate(~name,
ncol = 1,
nrow = 5,
scales = "free_y",
page = i
)
finish_fig()
}
} else {
plt <- plt +
ggplot2::facet_wrap(~name,
ncol = 1,
scales = "free_y"
)
finish_fig()
}
}
esp_traffic_long(data = dat, paginate = TRUE
)
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
ncolumn = 2,
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
dat <- AKesp::get_esp_data("Alaska Sablefish")
esp_traffic_long(data = dat, ncolumn = 2)
esp_traffic_long(data = dat, ncolumn = 2, paginate = TRUE
)
?ggforce::n_pages
devtools::load_all()
esp_traffic_long(data = dat, ncolumn = 2, paginate = TRUE
)
letters
str(letters)
c(letters, paste0(letters, letters))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
ncolumn = 2,
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
# sample text was copied from the sablefish report card
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg")
)
head(this_dat)
unique(this_dat$CATEGORY)
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
?stringr::str_wrap
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
dat <- AKesp::get_esp_data("Alaska Sablefish")
esp_traffic_tab_long(data = dat, year = 2016:2021)
devtools::load_all()
esp_traffic_tab_long(data = dat, year = 2016:2021)
devtools::load_all()
esp_traffic_tab_long(data = dat, year = 2016:2021)
devtools::load_all()
esp_traffic_tab_long(data = dat, year = 2016:2021)
devtools::load_all()
devtools::load_all()
esp_traffic_tab_long(data = dat, year = 2016:2021)
styler::style_file("R/table_functions.R")
devtools::load_all()
esp_traffic_tab_long(data = dat, year = 2016:2021)
roxygen2::roxygenise()
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
dat <- AKesp::get_esp_data("Alaska Sablefish")
head(dat)
unique(dat$CATEGORY)
dat %>% dplyr::select(INDICATOR_NAME, INDICATOR_TYPE, CATEGORY) %>% dplyr::distinct()
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
View(dat)
devtools::load_all()
prep_ind_data(data = dat)
esp_overall_score <- function(data, species, out = "ggplot", name) {
dat <- data %>%
prep_ind_data() %>%
dplyr::filter(YEAR >= 2000) %>%
dplyr::group_by(.data$CATEGORY, .data$YEAR) %>%
dplyr::mutate(
score = as.numeric(score),
mean_score = mean(.data$score, na.rm = TRUE)
) %>%
dplyr::select(
YEAR, INDICATOR_NAME, CATEGORY, INDICATOR_TYPE,
score, mean_score
) %>%
dplyr::distinct()
dat$CATEGORY <- factor(dat$CATEGORY,
levels = c("Physical",
"Lower Trophic",
"Upper Trophic",
"Fishery Performance",
"Economic",
"Community"))
ymax <- max(abs(dat$mean_score))
plt <- ggplot2::ggplot(
dat,
ggplot2::aes(
x = .data$YEAR,
y = .data$mean_score,
color = .data$CATEGORY
)
) +
ggplot2::geom_hline(
yintercept = 0,
lty = "dashed"
) +
ggplot2::geom_line() +
ggplot2::geom_point() +
ggplot2::ylab("Score") +
ggplot2::xlab(ggplot2::element_blank()) +
ggplot2::theme_bw(base_size = 16) +
ggplot2::theme(
legend.title = ggplot2::element_blank(),
legend.position = "bottom",
legend.direction = "vertical",
) +
ggplot2::ggtitle(label = paste("Overall Stage 1 Score for", species)) +
ggplot2::ylim(-ymax, ymax) +
ggplot2::facet_grid(rows = ggplot2::vars(.data$INDICATOR_TYPE))
if (out == "save") {
ggplot2::ggsave(plt, filename = name, ...)
} else if (out == "ggplot") {
print(plt)
cat("\n\n")
} else {
stop("Please specify output format")
}
}
esp_overall_score(data = dat, species = "test")
?theme
devtools::load_all()
dat <- AKesp::get_esp_data("Alaska Sablefish")
esp_overall_score(data = dat, species = "test")
roxygen2::roxygenise()
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
roxygen2::roxygenise()
indicator_order <- read.csv(here::here("data-raw/ESP_Lookup_Order.csv"))
usethis::use_data(indicator_order)
my_save <- function(x) {
data <- get(x)
sinew::makeOxygen(data)
print(x)
}
sink("R/data2.R")
my_save("indicator_order")
sink()
head(indicator_order)
tail(indicator_order)
roxygen2::roxygenise()
dat <- AKesp::get_esp_data("Alaska Sablefish")
AKesp::prep_ind_data(data = dat)
head(dat)
View(head(dat))
head(indicator_order)
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
prep_ind_data(data = dat)
head(dat)
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
warnings()
?ggplot2::geom_label
?scale_fontface_manual
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
?fontface
?ggplot2::geom_label
devtools::load_all()
rmarkdown::render(here::here("inst/esp-report-card-template.Rmd"),
clean = FALSE,
params = list(esp_data = AKesp::get_esp_data("Alaska Sablefish"),
fish = "Sablefish",
region = "Alaska",
stock_image = "images/noaa.jpg",
con_model_path = "images/noaa.jpg",
bayes_path = "images/noaa.jpg"))
roxygen2::roxygenise()
pkgdown::build_site()
my_save <- function(x) {
data <- get(x)
sinew::makeOxygen(data)
print(x)
}
sink("R/data2.R")
my_save("bbrkc_long")
sink()
roxygen2::roxygenise()
styler::style_dir("R")
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
roxygen2::roxygenise()
pkgdown::build_site()
pkgdown::build_site()
styler::style_dir("vignettes", filetype = "Rmd")
>rmarkdown::render
?rmarkdown::render
styler::style_file("examples/developing_report_card.R")
# install package
devtools::install_github("atyrell3/AKesp")
